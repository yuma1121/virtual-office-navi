---
import CTAButton from './CTAButton.astro';

export interface Props {
  name: string;
  description: string;
  price: string;
  features: string[];
  rating: number;
  affiliateUrl: string;
  ctaText?: string;
  badge?: string;
}

const {
  name,
  description,
  price,
  features,
  rating,
  affiliateUrl,
  ctaText = '公式サイトを見る',
  badge,
} = Astro.props;

function renderStars(rating: number): string {
  const fullStars = Math.floor(rating);
  const halfStar = rating % 1 >= 0.5 ? 1 : 0;
  const emptyStars = 5 - fullStars - halfStar;
  return '★'.repeat(fullStars) + (halfStar ? '☆' : '') + '☆'.repeat(emptyStars);
}
---

<div class="relative bg-white rounded-2xl shadow-md border border-gray-200 overflow-hidden hover:shadow-lg transition-shadow">
  {badge && (
    <div class="absolute top-0 right-0 bg-accent text-white text-xs font-bold px-3 py-1 rounded-bl-lg">
      {badge}
    </div>
  )}

  <div class="p-6">
    <h3 class="text-xl font-bold text-navy mb-2">{name}</h3>
    <p class="text-gray-600 text-sm mb-4">{description}</p>

    <div class="flex items-baseline gap-1 mb-4">
      <span class="text-3xl font-bold text-primary-600">{price}</span>
      <span class="text-sm text-gray-500">/月</span>
    </div>

    <div class="flex items-center gap-2 mb-4">
      <span class="text-accent">{renderStars(rating)}</span>
      <span class="text-sm text-gray-500">({rating})</span>
    </div>

    <ul class="space-y-2 mb-6">
      {features.map((feature) => (
        <li class="flex items-start gap-2 text-sm text-gray-700">
          <svg class="w-5 h-5 text-primary-500 shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
          </svg>
          {feature}
        </li>
      ))}
    </ul>

    <div class="text-center">
      <CTAButton
        serviceName={name}
        url={affiliateUrl}
        ctaText={ctaText}
        color="primary"
      />
    </div>
  </div>
</div>
