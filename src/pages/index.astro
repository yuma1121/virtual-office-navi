---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const allPosts = await getCollection('blog');
const recentPosts = allPosts
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 6);

const categories = [
  { slug: 'comparison', name: '比較・ランキング', description: '料金やサービスを横断比較' },
  { slug: 'review', name: 'サービスレビュー', description: '実際に使った体験レビュー' },
  { slug: 'area', name: 'エリア別おすすめ', description: '地域ごとのおすすめを紹介' },
  { slug: 'howto', name: '使い方・手続き', description: '登記や届出の手順を解説' },
  { slug: 'concern', name: 'お悩み解決', description: 'よくある疑問・不安を解消' },
];

const categoryNameMap: Record<string, string> = {};
categories.forEach((c) => {
  categoryNameMap[c.slug] = c.name;
});

// カテゴリ別記事（各カテゴリ最大3件）
const postsByCategory = categories.map((cat) => ({
  ...cat,
  posts: allPosts
    .filter((p) => p.data.category === cat.slug)
    .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
    .slice(0, 3),
})).filter((cat) => cat.posts.length > 0);

const services = [
  'GMOオフィスサポート',
  'レゾナンス',
  'NAWABARI',
  'DMMバーチャルオフィス',
  'ワンストップビジネスセンター',
  'Karigo',
  'バーチャルオフィス1',
  'ユナイテッドオフィス',
];
---

<BaseLayout
  title="バーチャルオフィスおすすめ比較ナビ | 料金・口コミで徹底比較"
  description="バーチャルオフィスの料金・サービスを徹底比較。GMOオフィスサポート、レゾナンス、NAWABARI等の口コミ・評判を実体験ベースでレビュー。あなたに最適なバーチャルオフィスが見つかります。"
>
  <!-- First View: Hero + Logos = 100vh -->
  <div class="flex flex-col h-[calc(100dvh-3.5rem-1px)]">
    <!-- Hero Section -->
    <section class="relative bg-gray-900 overflow-hidden flex-1 flex items-center">
      <img
        src="/images/common/hero-section-image.webp"
        alt=""
        class="absolute inset-0 w-full h-full object-cover opacity-30"
        loading="eager"
        fetchpriority="high"
        width="1280"
        height="720"
        decoding="async"
      />
      <div class="absolute inset-0 bg-gradient-to-t from-gray-900/60 to-transparent"></div>
      <div class="relative container-wide w-full">
        <div class="max-w-3xl mx-auto text-center">
          <h1 class="hero-title text-3xl md:text-5xl font-bold tracking-tight leading-tight text-white mb-5">
            あなたに最適な<br />バーチャルオフィスが見つかる
          </h1>
          <p class="hero-title text-base md:text-lg text-gray-100 mb-10 max-w-2xl mx-auto">
            料金・機能・口コミを実体験ベースで徹底比較。<br />あなたに合うサービスが見つかります。
          </p>
          <div class="flex flex-col sm:flex-row gap-3 justify-center">
            <a
              href="/blog/virtual-office-osusume"
              class="inline-flex items-center justify-center px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors"
            >
              おすすめ比較を見る
              <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                ><path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 5l7 7-7 7"></path></svg
              >
            </a>
            <a
              href="#diagnosis"
              class="inline-flex items-center justify-center px-6 py-3 border border-white/30 text-white font-medium rounded-lg hover:bg-white/10 transition-colors"
            >
              診断で探す
            </a>
          </div>
        </div>
      </div>
    </section>

    <!-- Scrolling Service Logos -->
    <section class="border-y bg-white overflow-hidden shrink-0">
      <div class="py-4">
        <p class="text-center text-xs text-gray-400 mb-3">掲載バーチャルオフィスサービス</p>
        <div class="logo-scroll">
          <div class="logo-scroll-inner">
            {
              [...services, ...services].map((name) => (
                <span class="inline-flex items-center px-5 text-sm text-gray-400 font-medium whitespace-nowrap">
                  {name}
                </span>
              ))
            }
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Diagnosis Section -->
  <section id="diagnosis" class="py-10 md:py-14 bg-gradient-to-b from-blue-50/80 to-white">
    <div class="container-wide">
      <div class="max-w-2xl mx-auto">
        <div class="text-center mb-6">
          <span class="inline-block bg-blue-100 text-blue-700 text-xs font-semibold px-3 py-1 rounded-full mb-3">無料診断</span>
          <h2 class="text-xl font-bold text-gray-900 mb-2">あなたにぴったりのバーチャルオフィスは？</h2>
          <p class="text-sm text-gray-500">4つの質問に答えるだけで、最適なサービスをご提案します</p>
        </div>

        <!-- Progress Bar -->
        <div class="flex items-center justify-center mb-6" id="diagnosis-progress">
          <div class="progress-dot active" data-dot="1"><span>1</span></div>
          <div class="progress-line" data-line="1"></div>
          <div class="progress-dot" data-dot="2"><span>2</span></div>
          <div class="progress-line" data-line="2"></div>
          <div class="progress-dot" data-dot="3"><span>3</span></div>
          <div class="progress-line" data-line="3"></div>
          <div class="progress-dot" data-dot="4"><span>4</span></div>
        </div>

        <div id="diagnosis-app" class="bg-white rounded-2xl border border-gray-200 shadow-lg p-6 md:p-8 overflow-hidden">
          <div id="diagnosis-questions">
            <!-- Q1: あなたの状況は？ -->
            <div class="diagnosis-step" data-step="1">
              <div class="text-center mb-5">
                <p class="text-sm text-blue-600 font-semibold mb-1">STEP 1 / 4</p>
                <p class="text-lg font-bold text-gray-900">あなたの状況は？</p>
              </div>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                <button class="diagnosis-card" data-q="persona" data-v="freelance">
                  <div class="diagnosis-card-icon">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>
                  </div>
                  <div class="diagnosis-card-text">
                    <span class="diagnosis-card-title">フリーランス・個人事業主</span>
                    <span class="diagnosis-card-desc">開業届や住所利用が必要</span>
                  </div>
                </button>
                <button class="diagnosis-card" data-q="persona" data-v="corp">
                  <div class="diagnosis-card-icon">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" /></svg>
                  </div>
                  <div class="diagnosis-card-text">
                    <span class="diagnosis-card-title">ひとり法人・マイクロ法人</span>
                    <span class="diagnosis-card-desc">法人登記できる住所が必要</span>
                  </div>
                </button>
                <button class="diagnosis-card" data-q="persona" data-v="ec">
                  <div class="diagnosis-card-icon">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 100 4 2 2 0 000-4z" /></svg>
                  </div>
                  <div class="diagnosis-card-text">
                    <span class="diagnosis-card-title">ネットショップ・EC運営</span>
                    <span class="diagnosis-card-desc">特商法の住所表記に使いたい</span>
                  </div>
                </button>
                <button class="diagnosis-card" data-q="persona" data-v="sidejob">
                  <div class="diagnosis-card-icon">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>
                  </div>
                  <div class="diagnosis-card-text">
                    <span class="diagnosis-card-title">副業・これから起業予定</span>
                    <span class="diagnosis-card-desc">まずは低コストで始めたい</span>
                  </div>
                </button>
              </div>
            </div>
            <!-- Q2: 主な利用目的は？ -->
            <div class="diagnosis-step hidden" data-step="2">
              <div class="text-center mb-5">
                <p class="text-sm text-blue-600 font-semibold mb-1">STEP 2 / 4</p>
                <p class="text-lg font-bold text-gray-900">主な利用目的は？</p>
              </div>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                <button class="diagnosis-card" data-q="purpose" data-v="registration">
                  <div class="diagnosis-card-icon">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
                  </div>
                  <div class="diagnosis-card-text">
                    <span class="diagnosis-card-title">法人登記・開業届の住所</span>
                    <span class="diagnosis-card-desc">登記や届出に使える住所が必要</span>
                  </div>
                </button>
                <button class="diagnosis-card" data-q="purpose" data-v="privacy">
                  <div class="diagnosis-card-icon">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" /></svg>
                  </div>
                  <div class="diagnosis-card-text">
                    <span class="diagnosis-card-title">自宅住所を隠したい</span>
                    <span class="diagnosis-card-desc">プライバシー保護が最優先</span>
                  </div>
                </button>
                <button class="diagnosis-card" data-q="purpose" data-v="branding">
                  <div class="diagnosis-card-icon">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                  </div>
                  <div class="diagnosis-card-text">
                    <span class="diagnosis-card-title">都心一等地でブランディング</span>
                    <span class="diagnosis-card-desc">信頼感・ブランド力を高めたい</span>
                  </div>
                </button>
                <button class="diagnosis-card" data-q="purpose" data-v="office">
                  <div class="diagnosis-card-icon">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" /></svg>
                  </div>
                  <div class="diagnosis-card-text">
                    <span class="diagnosis-card-title">オフィス機能も欲しい</span>
                    <span class="diagnosis-card-desc">電話転送・会議室も使いたい</span>
                  </div>
                </button>
              </div>
            </div>
            <!-- Q3: 希望エリアは？ -->
            <div class="diagnosis-step hidden" data-step="3">
              <div class="text-center mb-5">
                <p class="text-sm text-blue-600 font-semibold mb-1">STEP 3 / 4</p>
                <p class="text-lg font-bold text-gray-900">希望エリアは？</p>
              </div>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                <button class="diagnosis-card" data-q="area" data-v="tokyo">
                  <div class="diagnosis-card-icon">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" /></svg>
                  </div>
                  <div class="diagnosis-card-text">
                    <span class="diagnosis-card-title">東京都心</span>
                    <span class="diagnosis-card-desc">渋谷・港区・銀座エリア</span>
                  </div>
                </button>
                <button class="diagnosis-card" data-q="area" data-v="major">
                  <div class="diagnosis-card-icon">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                  </div>
                  <div class="diagnosis-card-text">
                    <span class="diagnosis-card-title">大阪・名古屋・福岡</span>
                    <span class="diagnosis-card-desc">主要都市の住所を使いたい</span>
                  </div>
                </button>
                <button class="diagnosis-card" data-q="area" data-v="local">
                  <div class="diagnosis-card-icon">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                  </div>
                  <div class="diagnosis-card-text">
                    <span class="diagnosis-card-title">地方・その他の都市</span>
                    <span class="diagnosis-card-desc">地方にも拠点があるサービス希望</span>
                  </div>
                </button>
                <button class="diagnosis-card" data-q="area" data-v="any">
                  <div class="diagnosis-card-icon">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" /></svg>
                  </div>
                  <div class="diagnosis-card-text">
                    <span class="diagnosis-card-title">こだわりなし</span>
                    <span class="diagnosis-card-desc">エリアよりサービス内容重視</span>
                  </div>
                </button>
              </div>
            </div>
            <!-- Q4: 最も重視するポイントは？ -->
            <div class="diagnosis-step hidden" data-step="4">
              <div class="text-center mb-5">
                <p class="text-sm text-blue-600 font-semibold mb-1">STEP 4 / 4</p>
                <p class="text-lg font-bold text-gray-900">最も重視するポイントは？</p>
              </div>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                <button class="diagnosis-card" data-q="priority" data-v="cost">
                  <div class="diagnosis-card-icon">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                  </div>
                  <div class="diagnosis-card-text">
                    <span class="diagnosis-card-title">月額料金の安さ</span>
                    <span class="diagnosis-card-desc">とにかくコストを抑えたい</span>
                  </div>
                </button>
                <button class="diagnosis-card" data-q="priority" data-v="mail">
                  <div class="diagnosis-card-icon">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>
                  </div>
                  <div class="diagnosis-card-text">
                    <span class="diagnosis-card-title">郵便転送の充実</span>
                    <span class="diagnosis-card-desc">転送頻度や写真通知が欲しい</span>
                  </div>
                </button>
                <button class="diagnosis-card" data-q="priority" data-v="facility">
                  <div class="diagnosis-card-icon">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" /></svg>
                  </div>
                  <div class="diagnosis-card-text">
                    <span class="diagnosis-card-title">電話対応・会議室</span>
                    <span class="diagnosis-card-desc">電話秘書や会議室も使いたい</span>
                  </div>
                </button>
                <button class="diagnosis-card" data-q="priority" data-v="trust">
                  <div class="diagnosis-card-icon">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" /></svg>
                  </div>
                  <div class="diagnosis-card-text">
                    <span class="diagnosis-card-title">運営会社の信頼性</span>
                    <span class="diagnosis-card-desc">大手・老舗の安心感が欲しい</span>
                  </div>
                </button>
              </div>
            </div>
          </div>
          <!-- Result -->
          <div id="diagnosis-result" class="hidden">
            <div class="text-center mb-6">
              <div class="inline-flex items-center justify-center w-16 h-16 bg-green-100 rounded-full mb-3">
                <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
              </div>
              <p class="text-sm text-green-600 font-semibold mb-1">診断結果</p>
              <p class="text-sm text-gray-500">あなたにおすすめのサービスはこちら</p>
            </div>
            <!-- Primary recommendation -->
            <div class="relative bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl border-2 border-blue-200 p-5 mb-4">
              <span class="absolute -top-3 left-4 bg-blue-600 text-white text-xs font-bold px-3 py-1 rounded-full">BEST MATCH</span>
              <div class="mt-1">
                <p id="diagnosis-service" class="text-xl font-bold text-gray-900 mb-1"></p>
                <p id="diagnosis-price" class="text-sm text-blue-600 font-semibold mb-3"></p>
                <div id="diagnosis-features" class="flex flex-wrap gap-2 mb-3"></div>
                <p id="diagnosis-reason" class="text-sm text-gray-600 leading-relaxed mb-4"></p>
                <a id="diagnosis-link" href="" class="inline-flex items-center justify-center w-full px-5 py-2.5 bg-blue-600 text-white text-sm font-semibold rounded-lg hover:bg-blue-700 transition-colors">
                  詳しく見る
                  <svg class="w-4 h-4 ml-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
                </a>
              </div>
            </div>
            <!-- Secondary recommendation -->
            <div class="bg-gray-50 rounded-xl border border-gray-200 p-4 mb-5">
              <p class="text-xs text-gray-400 font-semibold mb-2">こちらもおすすめ</p>
              <div class="flex items-center justify-between">
                <div>
                  <p id="diagnosis-sub-service" class="text-sm font-bold text-gray-900"></p>
                  <p id="diagnosis-sub-reason" class="text-xs text-gray-500 mt-0.5"></p>
                </div>
                <a id="diagnosis-sub-link" href="" class="shrink-0 text-xs text-blue-600 hover:text-blue-800 font-medium ml-3">
                  詳しく &rarr;
                </a>
              </div>
            </div>
            <button id="diagnosis-reset" class="flex items-center justify-center gap-1.5 mx-auto text-sm text-gray-400 hover:text-blue-600 transition-colors">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>
              もう一度診断する
            </button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Categories Navigation -->
  <section class="py-10 md:py-12 border-t bg-gray-50/30">
    <div class="container-wide">
      <h2 class="text-lg font-semibold text-gray-900 mb-5">目的から探す</h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3">
        {
          categories.map((cat) => (
            <a
              href={`/category/${cat.slug}`}
              class="block rounded-lg border border-gray-200 bg-white px-4 py-3 hover:border-blue-300 hover:bg-blue-50/40 transition-all"
            >
              <span class="block text-sm font-medium text-gray-900">{cat.name}</span>
              <span class="block text-xs text-gray-400 mt-0.5">{cat.description}</span>
            </a>
          ))
        }
      </div>
    </div>
  </section>

  <!-- Recent Posts -->
  <section id="recent-posts" class="py-10 md:py-12 border-t">
    <div class="container-wide">
      <h2 class="text-lg font-semibold text-gray-900 mb-5">最新記事</h2>
      {
        recentPosts.length > 0 ? (
          <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
            {recentPosts.map((post) => (
              <a
                href={`/blog/${post.slug}`}
                class="group block bg-white rounded-lg border border-gray-200 p-5 hover:border-blue-300 hover:shadow-sm transition-all"
              >
                <div class="flex items-center gap-2 mb-2.5">
                  <span class="text-xs text-blue-600 font-medium">
                    {categoryNameMap[post.data.category] || post.data.category}
                  </span>
                  <span class="text-gray-200">|</span>
                  <time class="text-xs text-gray-400">
                    {post.data.pubDate.toLocaleDateString('ja-JP')}
                  </time>
                </div>
                <h3 class="text-[15px] font-semibold text-gray-900 leading-snug group-hover:text-blue-600 transition-colors">
                  {post.data.title}
                </h3>
                <p class="mt-2 text-sm text-gray-500 line-clamp-2">{post.data.description}</p>
              </a>
            ))}
          </div>
        ) : (
          <p class="text-gray-500">記事を準備中です。</p>
        )
      }
    </div>
  </section>

  <!-- Category Posts Sections -->
  {
    postsByCategory.map((cat) => (
      <section class="py-10 md:py-12 border-t">
        <div class="container-wide">
          <div class="flex items-center justify-between mb-5">
            <h2 class="text-lg font-semibold text-gray-900">{cat.name}</h2>
            <a
              href={`/category/${cat.slug}`}
              class="text-sm text-blue-600 hover:text-blue-800 font-medium"
            >
              もっと見る →
            </a>
          </div>
          <div class="grid md:grid-cols-3 gap-4">
            {cat.posts.map((post) => (
              <a
                href={`/blog/${post.slug}`}
                class="group block bg-white rounded-lg border border-gray-200 p-5 hover:border-blue-300 hover:shadow-sm transition-all"
              >
                <h3 class="text-[15px] font-semibold text-gray-900 leading-snug group-hover:text-blue-600 transition-colors">
                  {post.data.title}
                </h3>
                <p class="mt-2 text-sm text-gray-500 line-clamp-2">{post.data.description}</p>
              </a>
            ))}
          </div>
        </div>
      </section>
    ))
  }

</BaseLayout>

<style>
  .logo-scroll {
    width: 100%;
    overflow: hidden;
  }
  .logo-scroll-inner {
    display: flex;
    width: max-content;
    animation: scroll-logos 20s linear infinite;
  }
  @keyframes scroll-logos {
    0% { transform: translateX(0); }
    100% { transform: translateX(-50%); }
  }
  .diagnosis-card {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    padding: 1rem;
    border: 1px solid #e5e7eb;
    border-radius: 0.75rem;
    text-align: left;
    transition: all 0.2s;
    background: white;
    cursor: pointer;
  }
  .diagnosis-card:hover {
    border-color: #93c5fd;
    background: #eff6ff;
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(37, 99, 235, 0.1);
  }
  .diagnosis-card-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 2.5rem;
    height: 2.5rem;
    border-radius: 0.625rem;
    background: #eff6ff;
    color: #2563eb;
    flex-shrink: 0;
  }
  .diagnosis-card:hover .diagnosis-card-icon {
    background: #dbeafe;
  }
  .diagnosis-card-text {
    display: flex;
    flex-direction: column;
    gap: 0.125rem;
    min-width: 0;
  }
  .diagnosis-card-title {
    font-size: 0.875rem;
    font-weight: 600;
    color: #111827;
  }
  .diagnosis-card-desc {
    font-size: 0.75rem;
    color: #9ca3af;
  }
  .progress-dot {
    width: 2rem;
    height: 2rem;
    border-radius: 9999px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.75rem;
    font-weight: 700;
    background: #e5e7eb;
    color: #9ca3af;
    transition: all 0.3s;
  }
  .progress-dot.active {
    background: #2563eb;
    color: white;
  }
  .progress-dot.done {
    background: #22c55e;
    color: white;
  }
  .progress-line {
    width: 3rem;
    height: 2px;
    background: #e5e7eb;
    transition: background 0.3s;
  }
  .progress-line.done {
    background: #22c55e;
  }
  .diagnosis-step {
    animation: fadeSlideIn 0.3s ease-out;
  }
  @keyframes fadeSlideIn {
    from { opacity: 0; transform: translateX(20px); }
    to { opacity: 1; transform: translateX(0); }
  }
  #diagnosis-result:not(.hidden) {
    animation: fadeScaleIn 0.4s ease-out;
  }
  @keyframes fadeScaleIn {
    from { opacity: 0; transform: scale(0.95); }
    to { opacity: 1; transform: scale(1); }
  }
  .feature-tag {
    display: inline-flex;
    align-items: center;
    padding: 0.25rem 0.625rem;
    border-radius: 9999px;
    font-size: 0.75rem;
    font-weight: 500;
    background: #eff6ff;
    color: #2563eb;
    border: 1px solid #dbeafe;
  }
  .hero-title {
    text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
  }
</style>

<script>
  const answers: Record<string, string> = {};
  const steps = document.querySelectorAll('.diagnosis-step');
  const resultEl = document.getElementById('diagnosis-result');
  const questionsEl = document.getElementById('diagnosis-questions');

  interface ServiceInfo {
    key: string;
    name: string;
    price: string;
    features: string[];
    link: string;
    reasons: Record<string, string>;
  }

  const serviceData: Record<string, ServiceInfo> = {
    gmo: {
      key: 'gmo', name: 'GMOオフィスサポート', price: '月額660円〜',
      features: ['初期費用0円', '全国19拠点', '転送料込み'],
      link: '/blog/gmo-office-support-review',
      reasons: {
        default: '初期費用0円・月額660円〜の業界最安クラス。GMOグループの安心感も魅力です。',
        budget_low: '月額660円〜で初期費用も完全無料。郵便転送料金も基本料に含まれるコスパ最強サービスです。',
        area_regional: '名古屋・大阪・福岡など全国19拠点に対応。地方都市でも使える安心感があります。',
        purpose_reg: '法人登記対応プランが月額1,650円〜。GMOあおぞらネット銀行との連携で口座開設もスムーズ。',
        priority_trust: 'GMOインターネットグループ運営で安心感抜群。月額660円〜の業界最安クラスも魅力です。',
      },
    },
    resonance: {
      key: 'resonance', name: 'レゾナンス', price: '月額990円〜',
      features: ['法人登記990円〜', '全店舗会議室', '4銀行紹介'],
      link: '/blog/gmo-vs-resonance',
      reasons: {
        default: '法人登記が月額990円〜で業界最安級。全店舗に会議室完備、4つの銀行紹介にも対応。',
        priority_mail: '郵便物の写真通知が全プラン無料。港区浜松町の住所で週1回の転送も付いてきます。',
        area_tokyo: '港区・銀座・渋谷など東京都心に11店舗。全店舗で会議室が使えるのも魅力です。',
        purpose_reg: '法人登記990円〜は格安。みずほ銀行を含む4行の紹介制度で口座開設もサポートします。',
      },
    },
    nawabari: {
      key: 'nawabari', name: 'NAWABARI', price: '月額1,100円〜',
      features: ['EC/特商法特化', 'BASEパートナー', 'プライバシーマーク'],
      link: '/blog/virtual-office-netshop',
      reasons: {
        default: 'ネットショップの特商法対策に特化。BASEの公式パートナーで、プライバシーマーク取得済みの安心感。',
        persona_ec: 'EC運営者のために作られたサービス。BASE公式パートナーで特商法表記にそのまま使えます。',
        purpose_privacy: 'プライバシーマーク取得済み、GPS・盗聴器チェックまで実施。個人情報保護を最優先にするなら最適。',
      },
    },
    dmm: {
      key: 'dmm', name: 'DMMバーチャルオフィス', price: '月額660円〜',
      features: ['大手DMM運営', '全国14拠点', '全拠点会議室'],
      link: '/blog/virtual-office-tokyo',
      reasons: {
        default: '大手DMMグループが運営する安心のサービス。渋谷・銀座など一等地の住所が月額660円〜。',
        purpose_brand: '渋谷・銀座・青山など一等地住所が月額660円〜。大手DMMの知名度で取引先への信頼度もアップ。',
        priority_trust: 'DMMグループ運営で抜群の安心感。全拠点に会議室完備、AI秘書サービスも利用可能です。',
        area_regional: '札幌から沖縄まで全国14拠点。大手ならではの幅広いエリアカバーが魅力です。',
      },
    },
    onestop: {
      key: 'onestop', name: 'ワンストップビジネスセンター', price: '月額5,280円〜',
      features: ['全国48拠点', '電話秘書代行', '30日返金保証'],
      link: '/blog/virtual-office-osusume',
      reasons: {
        default: '全国48拠点＋電話秘書代行＋会議室のフルサービス。30日間返金保証で安心して始められます。',
        purpose_office: '電話秘書代行・会議室・来客対応まで揃うオールインワン。リアルオフィスに近い環境が手に入ります。',
        area_local: '北海道から九州まで全国48拠点。地方都市でもフルサービスのバーチャルオフィスが使えます。',
      },
    },
    karigo: {
      key: 'karigo', name: 'Karigo', price: '月額3,300円〜',
      features: ['全国60拠点以上', '創業20年', '転送頻度自由'],
      link: '/blog/virtual-office-osusume',
      reasons: {
        default: '創業20年・全国60拠点以上の老舗サービス。郵便転送頻度を自由に変更できる柔軟さが魅力。',
        area_local: '全国60拠点以上で業界最多。地方都市でも選べる拠点の多さはKarigoならでは。',
      },
    },
    vo1: {
      key: 'vo1', name: 'バーチャルオフィス1', price: '月額880円〜',
      features: ['法人登記最安880円', '初期費用0円', '口座開設保証'],
      link: '/blog/virtual-office-osusume',
      reasons: {
        default: '法人登記対応で月額880円は業界最安値。初期費用も0円で、法人口座開設保証制度も付き。',
        budget_low: '法人登記込みで月額880円＋初期費用0円。年間コスト10,560円は業界トップクラスの安さです。',
        purpose_reg: '法人登記880円〜は業界最安。口座開設保証制度付きで、法人設立をトータルでサポート。',
      },
    },
    united: {
      key: 'united', name: 'ユナイテッドオフィス', price: '月額2,310円〜',
      features: ['東京一等地9拠点', '全拠点会議室', '実績21年'],
      link: '/blog/virtual-office-osusume',
      reasons: {
        default: '銀座・青山・表参道など東京一等地に9拠点。全拠点で会議室が使える21年の実績。',
        area_tokyo: '東京の一等地に特化した9拠点。銀座・青山・表参道の住所でビジネスの信頼度を高められます。',
        purpose_brand: '銀座・青山・虎ノ門など東京プレミアム住所に特化。21年の運営実績と自社物件の安定感が強み。',
      },
    },
  };

  // スコアリング行列: 各回答 → 各サービスへの加点
  const scoreMatrix: Record<string, Record<string, Record<string, number>>> = {
    persona: {
      freelance: { gmo: 8, resonance: 5, nawabari: 3, dmm: 8, onestop: 0, karigo: 0, vo1: 8, united: 3 },
      corp:      { gmo: 5, resonance: 10, nawabari: 0, dmm: 5, onestop: 8, karigo: 5, vo1: 5, united: 8 },
      ec:        { gmo: 3, resonance: 3, nawabari: 25, dmm: 3, onestop: 0, karigo: 0, vo1: 0, united: 0 },
      sidejob:   { gmo: 10, resonance: 3, nawabari: 3, dmm: 8, onestop: 0, karigo: 0, vo1: 10, united: 0 },
    },
    purpose: {
      registration: { gmo: 8, resonance: 12, nawabari: 0, dmm: 8, onestop: 5, karigo: 5, vo1: 10, united: 5 },
      privacy:      { gmo: 5, resonance: 3, nawabari: 18, dmm: 5, onestop: 0, karigo: 0, vo1: 3, united: 0 },
      branding:     { gmo: 3, resonance: 8, nawabari: 0, dmm: 12, onestop: 5, karigo: 0, vo1: 0, united: 12 },
      office:       { gmo: 0, resonance: 5, nawabari: 0, dmm: 3, onestop: 18, karigo: 8, vo1: 0, united: 10 },
    },
    area: {
      tokyo: { gmo: 5, resonance: 12, nawabari: 5, dmm: 8, onestop: 5, karigo: 5, vo1: 8, united: 15 },
      major: { gmo: 10, resonance: 3, nawabari: 0, dmm: 10, onestop: 8, karigo: 8, vo1: 0, united: 0 },
      local: { gmo: 5, resonance: 0, nawabari: 0, dmm: 3, onestop: 12, karigo: 18, vo1: 0, united: 0 },
      any:   { gmo: 5, resonance: 5, nawabari: 3, dmm: 5, onestop: 5, karigo: 5, vo1: 5, united: 3 },
    },
    priority: {
      cost:     { gmo: 15, resonance: 8, nawabari: 5, dmm: 12, onestop: 0, karigo: 0, vo1: 18, united: 0 },
      mail:     { gmo: 10, resonance: 15, nawabari: 3, dmm: 5, onestop: 8, karigo: 8, vo1: 5, united: 3 },
      facility: { gmo: 0, resonance: 8, nawabari: 5, dmm: 5, onestop: 18, karigo: 8, vo1: 0, united: 12 },
      trust:    { gmo: 12, resonance: 8, nawabari: 5, dmm: 12, onestop: 8, karigo: 5, vo1: 3, united: 8 },
    },
  };

  function getRecommendation() {
    // スコア計算
    const scores: Record<string, number> = {
      gmo: 0, resonance: 0, nawabari: 0, dmm: 0,
      onestop: 0, karigo: 0, vo1: 0, united: 0,
    };

    for (const [question, answer] of Object.entries(answers)) {
      const matrix = scoreMatrix[question]?.[answer];
      if (matrix) {
        for (const [key, points] of Object.entries(matrix)) {
          scores[key] += points;
        }
      }
    }

    // スコア順にソート
    const sorted = Object.entries(scores).sort((a, b) => b[1] - a[1]);
    const primary = sorted[0][0];
    const secondary = sorted[1][0];

    // 理由生成: Q4 → Q2 → Q3 → Q1 → default の優先順
    const reason = generateReason(primary);
    const subReason = generateSubReason(secondary);

    return { primary, secondary, reason, subReason };
  }

  function generateReason(serviceKey: string): string {
    const service = serviceData[serviceKey];
    if (!service) return '';

    const { persona, purpose, area, priority } = answers;

    // Q4 priority ベースの理由
    if (priority === 'cost' && service.reasons.budget_low) return service.reasons.budget_low;
    if (priority === 'mail' && service.reasons.priority_mail) return service.reasons.priority_mail;
    if (priority === 'facility' && service.reasons.purpose_office) return service.reasons.purpose_office;
    if (priority === 'trust' && service.reasons.priority_trust) return service.reasons.priority_trust;

    // Q2 purpose ベースの理由
    if (purpose === 'registration' && service.reasons.purpose_reg) return service.reasons.purpose_reg;
    if (purpose === 'privacy' && service.reasons.purpose_privacy) return service.reasons.purpose_privacy;
    if (purpose === 'branding' && service.reasons.purpose_brand) return service.reasons.purpose_brand;
    if (purpose === 'office' && service.reasons.purpose_office) return service.reasons.purpose_office;

    // Q3 area ベースの理由
    if (area === 'tokyo' && service.reasons.area_tokyo) return service.reasons.area_tokyo;
    if ((area === 'major' || area === 'local') && service.reasons.area_regional) return service.reasons.area_regional;
    if (area === 'local' && service.reasons.area_local) return service.reasons.area_local;

    // Q1 persona ベースの理由
    if (persona === 'ec' && service.reasons.persona_ec) return service.reasons.persona_ec;

    return service.reasons.default;
  }

  function generateSubReason(serviceKey: string): string {
    const service = serviceData[serviceKey];
    if (!service) return '';

    // サブ推薦は短い特徴ベースのサマリー
    const { priority } = answers;
    if (priority === 'cost') return `${service.price}で始められる`;
    if (priority === 'mail') return '郵便転送サービスも充実';
    if (priority === 'facility') return '会議室・電話も利用可能';
    if (priority === 'trust') return '運営実績と信頼性が強み';
    return service.reasons.default.slice(0, 30) + '…';
  }

  document.querySelectorAll('.diagnosis-card').forEach((btn) => {
    btn.addEventListener('click', () => {
      const el = btn as HTMLElement;
      const q = el.dataset.q!;
      const v = el.dataset.v!;
      answers[q] = v;

      const currentStep = el.closest('.diagnosis-step') as HTMLElement;
      const stepNum = parseInt(currentStep.dataset.step!);

      // Update progress
      const dot = document.querySelector(`.progress-dot[data-dot="${stepNum}"]`);
      dot?.classList.remove('active');
      dot?.classList.add('done');
      const line = document.querySelector(`.progress-line[data-line="${stepNum}"]`);
      line?.classList.add('done');

      const nextStep = currentStep.nextElementSibling as HTMLElement | null;
      if (nextStep && nextStep.classList.contains('diagnosis-step')) {
        currentStep.classList.add('hidden');
        nextStep.classList.remove('hidden');
        const nextDot = document.querySelector(`.progress-dot[data-dot="${stepNum + 1}"]`);
        nextDot?.classList.add('active');
      } else {
        showResult();
      }
    });
  });

  function showResult() {
    const progress = document.getElementById('diagnosis-progress');
    progress?.classList.add('hidden');
    questionsEl!.classList.add('hidden');
    resultEl!.classList.remove('hidden');

    const { primary, secondary, reason, subReason } = getRecommendation();
    const p = serviceData[primary];
    const s = serviceData[secondary];

    document.getElementById('diagnosis-service')!.textContent = p.name;
    document.getElementById('diagnosis-price')!.textContent = p.price;
    document.getElementById('diagnosis-reason')!.textContent = reason;
    document.getElementById('diagnosis-link')!.setAttribute('href', p.link);

    const featuresEl = document.getElementById('diagnosis-features')!;
    featuresEl.innerHTML = p.features.map(f => `<span class="feature-tag">${f}</span>`).join('');

    document.getElementById('diagnosis-sub-service')!.textContent = s.name;
    document.getElementById('diagnosis-sub-reason')!.textContent = subReason;
    document.getElementById('diagnosis-sub-link')!.setAttribute('href', s.link);
  }

  document.getElementById('diagnosis-reset')?.addEventListener('click', () => {
    Object.keys(answers).forEach((k) => delete answers[k]);

    document.querySelectorAll('.progress-dot').forEach((dot, i) => {
      dot.classList.remove('active', 'done');
      if (i === 0) dot.classList.add('active');
    });
    document.querySelectorAll('.progress-line').forEach(line => line.classList.remove('done'));
    document.getElementById('diagnosis-progress')?.classList.remove('hidden');

    steps.forEach((s, i) => {
      if (i === 0) s.classList.remove('hidden');
      else s.classList.add('hidden');
    });
    questionsEl!.classList.remove('hidden');
    resultEl!.classList.add('hidden');
  });
</script>
